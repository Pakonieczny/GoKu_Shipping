<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Modals</title>
  <!-- Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Optional: Custom modal styling */
    .modal { max-height: 90%; }
    .modal .modal-content { overflow-y: auto; }
    table.striped td, table.striped th {
      padding: 8px 12px;
      text-align: center;
    }
    table.striped button {
      min-width: 30px;
      padding: 0;
    }
    table.striped span {
      display: inline-block;
      width: 40px;
    }
  </style>
</head>
<body>
  <!-- Metadata Modal -->
  <div id="metadataModal" class="modal">
    <div class="modal-content">
      <h4>Photo Metadata</h4>
      <textarea id="metadataTextarea" readonly style="width:100%; height:300px;"></textarea>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-green btn">Close</a>
    </div>
  </div>

  <!-- Crop Modal -->
  <div id="cropModal" class="modal">
    <div class="modal-content">
      <h4>Crop Image</h4>
      <div class="img-preview-container" style="text-align: center;">
        <img id="cropImage" src="" alt="Image to crop" style="max-width:100%;">
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" id="saveCropBtn" class="modal-close waves-effect waves-green btn">Save Crop</a>
      <a href="#!" id="cancelCropBtn" class="modal-close waves-effect waves-red btn">Cancel</a>
    </div>
  </div>

  <!-- Configure UI Elements Modal -->
  <div id="buttonConfigModalNew" class="modal">
    <div class="modal-content">
      <h4>Configure UI Elements</h4>
      <p>Adjust the Left (px) and Top (px) offsets for each UI element:</p>
      <table id="uiConfigTable" class="striped">
        <thead>
          <tr>
            <th>Element ID</th>
            <th>Left (px)</th>
            <th>Top (px)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Table rows will be generated dynamically -->
        </tbody>
      </table>
    </div>
    <div class="modal-footer">
      <a href="#!" id="saveUIConfigBtn" class="modal-close waves-effect waves-green btn">Save Config</a>
    </div>
  </div>

  <!-- Include jQuery and Materialize JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Initialize Materialize components (modals, etc.)
      M.AutoInit();

      // Function to populate the UI Configuration Table
      function populateUIConfigTable() {
        var tbody = document.querySelector("#uiConfigTable tbody");
        tbody.innerHTML = ""; // Clear existing rows

        // Get all elements with the "configurable" class
        var configurableElements = document.querySelectorAll('.configurable');
        configurableElements.forEach(function(el) {
          var id = el.id || "no-id";
          // Retrieve current positions from computed styles
          var computedStyle = window.getComputedStyle(el);
          var currentLeft = parseInt(computedStyle.left) || 0;
          var currentTop = parseInt(computedStyle.top) || 0;

          // Create a table row with controls for left and top offsets
          var row = document.createElement("tr");
          row.innerHTML = `
            <td>${id}</td>
            <td>
              <button class="decrease-left btn-small"><i class="material-icons">arrow_left</i></button>
              <span class="left-value">${currentLeft}</span>
              <button class="increase-left btn-small"><i class="material-icons">arrow_right</i></button>
            </td>
            <td>
              <button class="decrease-top btn-small"><i class="material-icons">arrow_drop_up</i></button>
              <span class="top-value">${currentTop}</span>
              <button class="increase-top btn-small"><i class="material-icons">arrow_drop_down</i></button>
            </td>
          `;
          tbody.appendChild(row);

          // Get control elements
          var decLeftBtn = row.querySelector(".decrease-left");
          var incLeftBtn = row.querySelector(".increase-left");
          var leftValueSpan = row.querySelector(".left-value");
          var decTopBtn = row.querySelector(".decrease-top");
          var incTopBtn = row.querySelector(".increase-top");
          var topValueSpan = row.querySelector(".top-value");

          // Define update functions that change the value and update the element's style
          decLeftBtn.addEventListener("click", function() {
            var newVal = parseInt(leftValueSpan.textContent) - 1;
            leftValueSpan.textContent = newVal;
            el.style.left = newVal + "px";
          });
          incLeftBtn.addEventListener("click", function() {
            var newVal = parseInt(leftValueSpan.textContent) + 1;
            leftValueSpan.textContent = newVal;
            el.style.left = newVal + "px";
          });
          decTopBtn.addEventListener("click", function() {
            var newVal = parseInt(topValueSpan.textContent) - 1;
            topValueSpan.textContent = newVal;
            el.style.top = newVal + "px";
          });
          incTopBtn.addEventListener("click", function() {
            var newVal = parseInt(topValueSpan.textContent) + 1;
            topValueSpan.textContent = newVal;
            el.style.top = newVal + "px";
          });
        });
      }

      // Attach the Save Config button click handler
      document.getElementById("saveUIConfigBtn").addEventListener("click", function() {
        // Optionally, you could persist these settings; live updates are already in effect.
        console.log("UI configuration saved.");
      });

      // Expose the populate function so it can be called before opening the modal.
      window.populateUIConfigTable = populateUIConfigTable;
    });
  </script>
</body>
</html>