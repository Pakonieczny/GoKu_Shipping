<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Modals</title>
  <!-- Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Increase the vertical size of the modal if needed */
    .modal {
      max-height: 90vh;
    }
    .modal .modal-content {
      overflow-y: auto;
    }
    table.striped td, table.striped th {
      padding: 8px 12px;
      text-align: center;
    }
    table.striped button {
      min-width: 30px;
      padding: 0;
    }
    table.striped span {
      display: inline-block;
      width: 40px;
    }
  </style>
</head>
<body>
  <!-- Configure UI Elements Modal -->
  <div id="buttonConfigModalNew" class="modal">
    <div class="modal-content">
      <h4>Configure UI Elements</h4>
      <p>Adjust the Left (px) and Top (px) offsets for each UI element:</p>
      <table id="uiConfigTable" class="striped">
        <thead>
          <tr>
            <th>Element ID</th>
            <th>Left (px)</th>
            <th>Top (px)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows will be generated dynamically -->
        </tbody>
      </table>
    </div>
    <div class="modal-footer">
      <a href="#!" id="saveUIConfigBtn" class="modal-close waves-effect waves-green btn">Save Config</a>
    </div>
  </div>
  
  <!-- Include jQuery and Materialize JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      M.AutoInit();
      
      // Function to populate the configuration table
      function populateUIConfigTable() {
        var tbody = document.querySelector("#uiConfigTable tbody");
        tbody.innerHTML = ""; // Clear any existing rows
        console.log("Populating UI configuration table...");
        
        // Select all elements with the 'configurable' class
        var configurableElements = document.querySelectorAll('.configurable');
        if (configurableElements.length === 0) {
          console.warn("No configurable elements found!");
        }
        configurableElements.forEach(function(el) {
          var id = el.id || "no-id";
          // Retrieve current left and top values from computed styles
          var computedStyle = window.getComputedStyle(el);
          var currentLeft = parseInt(computedStyle.left) || 0;
          var currentTop = parseInt(computedStyle.top) || 0;
          console.log("Found element:", id, "Left:", currentLeft, "Top:", currentTop);
          
          // Create a table row with arrow buttons
          var row = document.createElement("tr");
          row.innerHTML = `
            <td>${id}</td>
            <td>
              <button class="decrease-left btn-small"><i class="material-icons">arrow_left</i></button>
              <span class="left-value">${currentLeft}</span>
              <button class="increase-left btn-small"><i class="material-icons">arrow_right</i></button>
            </td>
            <td>
              <button class="decrease-top btn-small"><i class="material-icons">arrow_drop_up</i></button>
              <span class="top-value">${currentTop}</span>
              <button class="increase-top btn-small"><i class="material-icons">arrow_drop_down</i></button>
            </td>
          `;
          tbody.appendChild(row);
          
          // Get control elements
          var decLeftBtn = row.querySelector(".decrease-left");
          var incLeftBtn = row.querySelector(".increase-left");
          var leftValueSpan = row.querySelector(".left-value");
          var decTopBtn = row.querySelector(".decrease-top");
          var incTopBtn = row.querySelector(".increase-top");
          var topValueSpan = row.querySelector(".top-value");
          
          // Attach event listeners for live updates
          decLeftBtn.addEventListener("click", function() {
            var newVal = parseInt(leftValueSpan.textContent) - 1;
            leftValueSpan.textContent = newVal;
            el.style.left = newVal + "px";
            console.log(id, "updated Left to", newVal);
          });
          incLeftBtn.addEventListener("click", function() {
            var newVal = parseInt(leftValueSpan.textContent) + 1;
            leftValueSpan.textContent = newVal;
            el.style.left = newVal + "px";
            console.log(id, "updated Left to", newVal);
          });
          decTopBtn.addEventListener("click", function() {
            var newVal = parseInt(topValueSpan.textContent) - 1;
            topValueSpan.textContent = newVal;
            el.style.top = newVal + "px";
            console.log(id, "updated Top to", newVal);
          });
          incTopBtn.addEventListener("click", function() {
            var newVal = parseInt(topValueSpan.textContent) + 1;
            topValueSpan.textContent = newVal;
            el.style.top = newVal + "px";
            console.log(id, "updated Top to", newVal);
          });
        });
      }
      
      // Attach click handler to the Save Config button
      document.getElementById("saveUIConfigBtn").addEventListener("click", function() {
        console.log("Final configuration saved.");
        // Additional logic for persistence can be added here if needed.
      });
      
      // Expose the populate function globally
      window.populateUIConfigTable = populateUIConfigTable;
    });
  </script>
</body>
</html>