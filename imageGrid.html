async function updateImageGrid(data) {
  let items = [];
  if (data.transactions && Array.isArray(data.transactions) && data.transactions.length > 0) {
    items = data.transactions;
    console.log("Using 'transactions' as the purchased items array.");
  } else if (data.shipments && Array.isArray(data.shipments) && data.shipments.length > 0) {
    items = data.shipments;
    console.log("Using 'shipments' as the purchased items array.");
  } else if (Array.isArray(data) && data.length > 0) {
    items = data;
  } else if (data.results && Array.isArray(data.results) && data.results.length > 0) {
    items = data.results;
  } else if (data.orders && Array.isArray(data.orders) && data.orders.length > 0) {
    items = data.orders;
  } else if (typeof data === 'object' && data !== null) {
    for (const key in data) {
      if (Array.isArray(data[key]) && data[key].length > 0) {
        items = data[key];
        console.log("Found purchased items array under key:", key);
        break;
      }
    }
  }
  
  if (!items.length) {
    console.error("Order data does not contain a valid array of purchased items.", data);
    return;
  }
  
  // Loop through 8 preview boxes.
  for (let i = 0; i < 8; i++) {
    const cell = document.getElementById("previewCell" + i);
    const qtyBox = document.getElementById("quantityCell" + i);
    if (cell && qtyBox) {
      if (i < items.length) {
        const item = items[i];
        const listingId = item.listing_id;
        try {
          const images = await fetchListingImages(listingId);
          if (images && images.length > 0) {
            const imageUrl = images[0].url_fullxfull;
            cell.innerHTML = `<img src="${imageUrl}" alt="Listing Image ${i}">`;
          } else {
            cell.innerHTML = "No images found";
          }
          // Set the quantity text box with "Quantity: " followed by the quantity
          qtyBox.value = "Quantity: " + (item.quantity !== undefined ? item.quantity : "");
        } catch (error) {
          console.error(`Error fetching images for listing ${listingId}:`, error);
          cell.innerHTML = "Error loading image";
          qtyBox.value = "";
        }
      } else {
        cell.innerHTML = "Empty";
        qtyBox.value = "";
      }
    }
  }
}