<!-- screenTwo.html -->
<div id="screenTwo" style="display:none;">
  <!-- "Return to Screen One" button -->
  <button id="goBackBtn" class="btn">Return to Screen One</button>

  <!-- 1) Chit Chat "Order Search" input/btn -->
  <label for="chitChatOrderSearch">Order Search:</label>
  <input
    type="text"
    id="chitChatOrderSearch"
    placeholder="Chit Chat Order #"
    style="height:10px; width:150px;"
  />
  <button id="chitChatSearchBtn" class="btn">Search</button>

  <!-- 2) Read-only text area => "Orders" for Chit Chat results -->
  <textarea
    id="chitChatOrders"
    readonly
    style="height:300px; width:250px;"
    placeholder="Chit Chat search results"
  ></textarea>

  <!-- 3) Duplicate "Open Config" modal => from Index.html but renamed for Screen Two -->
  <button id="openConfigBtnScreenTwo" class="configurable btn waves-effect waves-light">
    Open Config (Screen Two)
  </button>

  <div id="configModalScreenTwo" class="modal">
    <div class="modal-content">
      <table class="striped" id="configTableScreenTwo">
        <thead>
          <tr>
            <th>Component Name</th>
            <th>Left (px)</th>
            <th>Top (px)</th>
            <th>Width (px)</th>
            <th>Height (px)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="modal-footer">
      <a href="#!" id="saveConfigBtnScreenTwo" class="modal-close waves-effect waves-green btn">
        Save Config
      </a>
    </div>
  </div>

  <script>
    /**********************************************************
     * initScreenTwo():
     *   1) Re-init Materialize for the new modal
     *   2) loadPositionsScreenTwo() => force absolute positioning
     *   3) wire up the "Return to Screen One" button
     *   4) wire up the "Chit Chat" search
     *   5) wire up the config for Screen Two
     **********************************************************/
    function initScreenTwo() {
      console.log("Screen Two loaded!");

      // 1) Re-init Materialize so the new modal is recognized
      M.AutoInit();

      // 2) Force absolute positioning + load stored left/top
      loadPositionsScreenTwo();

      // 3) "Return to Screen One" button => show #screenOne, hide #screenTwo
      const backBtn = document.getElementById('goBackBtn');
      if(backBtn){
        backBtn.addEventListener('click', function(){
          const s2 = document.getElementById('screenTwo');
          const s1 = document.getElementById('screenOne');
          if(s2) s2.style.display = 'none';
          if(s1) s1.style.display = 'block';
        });
      }

      // 4) Chit Chat order search
      const searchBtn = document.getElementById('chitChatSearchBtn');
      if (searchBtn) {
        searchBtn.addEventListener('click', async () => {
          const query = document.getElementById('chitChatOrderSearch').value.trim();
          if (!query) {
            console.warn("No Chit Chat order query provided.");
            return;
          }
          console.log("Searching Chit Chat for order:", query);

          try {
            // Example: GET https://api.chitchat.com/v1/orders?search=<query>
            const response = await fetch(`https://api.chitchat.com/v1/orders?search=${encodeURIComponent(query)}`, {
              method: 'GET'
            });
            if (!response.ok) {
              throw new Error(`Chit Chat search failed: ${response.status} ${response.statusText}`);
            }
            const data = await response.json();
            console.log("Chit Chat Orders Data:", data);

            // Show result in #chitChatOrders
            const output = document.getElementById('chitChatOrders');
            output.value = JSON.stringify(data, null, 2);
          } catch (err) {
            console.error("Error fetching from Chit Chat:", err);
            const output = document.getElementById('chitChatOrders');
            output.value = "Error: " + err.message;
          }
        });
      }

      // 5) Screen Two config system
      const openConfigBtn2 = document.getElementById("openConfigBtnScreenTwo");
      if (openConfigBtn2) {
        openConfigBtn2.addEventListener("click", () => {
          populateConfigTableScreenTwo();
          const modalElem2 = document.getElementById("configModalScreenTwo");
          const instance2 = M.Modal.getInstance(modalElem2);
          instance2.open();
        });
      }

      const saveConfigBtn2 = document.getElementById("saveConfigBtnScreenTwo");
      if (saveConfigBtn2) {
        saveConfigBtn2.addEventListener("click", () => {
          saveConfigurationScreenTwo();
        });
      }
    }

    /********** COMPONENT IDs & Positions for Screen Two **********/
    const screenTwoComponentIDs = [
      "goBackBtn",
      "chitChatOrderSearch","chitChatSearchBtn","chitChatOrders",
      "openConfigBtnScreenTwo","saveConfigBtnScreenTwo"
    ];

    /***********************************************************
     * loadPositionsScreenTwo():
     *   - Force .style.position = "absolute"
     *   - If there's a stored left/top in localStorage, apply it
     *   - Otherwise default to 0,0 at top-left corner
     ***********************************************************/
    function loadPositionsScreenTwo(){
      screenTwoComponentIDs.forEach(id => {
        const el = document.getElementById(id);
        if(!el) return;

        // Force position: absolute so left/top changes move them
        el.style.position = "absolute";

        // Load stored or fallback to 0,0
        const savedLeft = localStorage.getItem(`pos2-${id}-left`);
        const savedTop  = localStorage.getItem(`pos2-${id}-top`);
        const savedWidth = localStorage.getItem(`pos2-${id}-width`);
        const savedHeight= localStorage.getItem(`pos2-${id}-height`);

        if(savedLeft !== null) {
          el.style.left = savedLeft + "px";
        } else {
          el.style.left = "0px";
        }
        if(savedTop !== null) {
          el.style.top = savedTop + "px";
        } else {
          el.style.top = "0px";
        }
        if(savedWidth !== null) {
          el.style.width = savedWidth + "px";
        }
        if(savedHeight!== null) {
          el.style.height= savedHeight+ "px";
        }
      });
    }

    function populateConfigTableScreenTwo(){
      const tbody = document.getElementById("configTableScreenTwo").querySelector("tbody");
      tbody.innerHTML="";
      screenTwoComponentIDs.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;

        // Use either the button's text, or input's placeholder, or the ID
        const compName = el.textContent.trim() || el.placeholder || id;
        const cs = window.getComputedStyle(el);
        // parse left, top, width, height
        const leftVal = (cs.left==="auto") ? 0 : parseInt(cs.left,10);
        const topVal  = (cs.top==="auto")  ? 0 : parseInt(cs.top,10);
        const widthVal= (cs.width==="auto")?0 : parseInt(cs.width,10);
        const heightVal=(cs.height==="auto")?0: parseInt(cs.height,10);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${compName}</td>
          <td><input type="number" value="${leftVal}" data-id="${id}" class="left-input2"></td>
          <td><input type="number" value="${topVal}"  data-id="${id}" class="top-input2"></td>
          <td><input type="number" value="${widthVal}" data-id="${id}" class="width-input2"></td>
          <td><input type="number" value="${heightVal}" data-id="${id}" class="height-input2"></td>
        `;
        tbody.appendChild(row);

        // Live updates: as user types, item moves/resizes
        row.querySelector(".left-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.left = parseInt(this.value,10)+"px";
        });
        row.querySelector(".top-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.top = parseInt(this.value,10)+"px";
        });
        row.querySelector(".width-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.width = parseInt(this.value,10)+"px";
        });
        row.querySelector(".height-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.height= parseInt(this.value,10)+"px";
        });
      });
    }

    function saveConfigurationScreenTwo(){
      screenTwoComponentIDs.forEach(id => {
        const el = document.getElementById(id);
        if(el){
          const cs=window.getComputedStyle(el);
          const leftVal  = parseInt(cs.left,10)||0;
          const topVal   = parseInt(cs.top,10)||0;
          const widthVal = parseInt(cs.width,10)||0;
          const heightVal= parseInt(cs.height,10)||0;
          // prefix them as pos2- to differentiate from screenOne
          localStorage.setItem(`pos2-${id}-left`, leftVal);
          localStorage.setItem(`pos2-${id}-top`, topVal);
          localStorage.setItem(`pos2-${id}-width`, widthVal);
          localStorage.setItem(`pos2-${id}-height`,heightVal);
        }
      });
      console.log("ScreenTwo configuration saved.");
    }
  </script>
</div>