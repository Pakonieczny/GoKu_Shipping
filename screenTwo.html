<!-- screenTwo.html -->
  <!-- Simple "Return to Screen One" button -->
  <button id="goBackBtn" class="btn">Return to Screen One</button>

  <!-- 1) Chit Chat "Order Search" input/btn -->
  <label for="chitChatOrderSearch">Order Search:</label>
  <input
    type="text"
    id="chitChatOrderSearch"
    placeholder="Chit Chat Order #"
    style="height:10px; width:150px;"
  />
  <button id="chitChatSearchBtn" class="btn">Search</button>

  <!-- 2) Read-only text area => "Orders" for Chit Chat results -->
  <textarea
    id="chitChatOrders"
    readonly
    style="height:300px; width:250px;"
    placeholder="Chit Chat search results"
  ></textarea>

  <!-- 3) Duplicate "Open Config" modal => from Index.html but renamed for Screen Two -->
  <button id="openConfigBtnScreenTwo" class="configurable btn waves-effect waves-light">
    Open Config (Screen Two)
  </button>

  <div id="configModalScreenTwo" class="modal">
    <div class="modal-content">
      <table class="striped" id="configTableScreenTwo">
        <thead>
          <tr>
            <th>Component Name</th>
            <th>Left (px)</th>
            <th>Top (px)</th>
            <th>Width (px)</th>
            <th>Height (px)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="modal-footer">
      <a href="#!" id="saveConfigBtnScreenTwo" class="modal-close waves-effect waves-green btn">
        Save Config
      </a>
    </div>
  </div>

  <script>
    /**********************************************************
     * Called after screenTwo.html is injected and appended.
     * We'll do three main things:
     *  1) Re-init Materialize so the new modal is recognized.
     *  2) Wire up the "Chit Chat" order search logic.
     *  3) Wire up the config system for Screen Two.
     *  4) Restore the "Return to Screen One" button.
     **********************************************************/
    function initScreenTwo() {
      console.log("Screen Two loaded!");

      // 1) Re-init Materialize so this new modal is recognized:
      M.AutoInit(); 
      // Alternatively, we could do:
      // const modalElem = document.getElementById('configModalScreenTwo');
      // M.Modal.init(modalElem);

      // 2) "Return to Screen One" button => show #screenOne, hide #screenTwo
      const backBtn = document.getElementById('goBackBtn');
      if(backBtn){
        backBtn.addEventListener('click', function(){
          const s2 = document.getElementById('screenTwo');
          const s1 = document.getElementById('screenOne');
          if(s2) s2.style.display = 'none';
          if(s1) s1.style.display = 'block';
        });
      }

      // 3) Chit Chat order search
      const searchBtn = document.getElementById('chitChatSearchBtn');
      if (searchBtn) {
        searchBtn.addEventListener('click', async () => {
          const query = document.getElementById('chitChatOrderSearch').value.trim();
          if (!query) {
            console.warn("No Chit Chat order query provided.");
            return;
          }
          console.log("Searching Chit Chat for order:", query);

          try {
            // Suppose your Chit Chat endpoint is something like:
            // GET https://api.chitchat.com/v1/orders?search=...
            const response = await fetch(`https://api.chitchat.com/v1/orders?search=${encodeURIComponent(query)}`, {
              method: 'GET'
            });
            if (!response.ok) {
              throw new Error(`Chit Chat search failed: ${response.status} ${response.statusText}`);
            }
            const data = await response.json();
            console.log("Chit Chat Orders Data:", data);

            // show result in #chitChatOrders
            const output = document.getElementById('chitChatOrders');
            output.value = JSON.stringify(data, null, 2);
          } catch (err) {
            console.error("Error fetching from Chit Chat:", err);
            const output = document.getElementById('chitChatOrders');
            output.value = "Error: " + err.message;
          }
        });
      }

      // 4) Duplicate config system for Screen Two
      const openConfigBtn2 = document.getElementById("openConfigBtnScreenTwo");
      if (openConfigBtn2) {
        openConfigBtn2.addEventListener("click", () => {
          populateConfigTableScreenTwo();
          const modalElem2 = document.getElementById("configModalScreenTwo");
          const instance2 = M.Modal.getInstance(modalElem2);
          instance2.open();
        });
      }

      const saveConfigBtn2 = document.getElementById("saveConfigBtnScreenTwo");
      if (saveConfigBtn2) {
        saveConfigBtn2.addEventListener("click", () => {
          saveConfigurationScreenTwo();
        });
      }
    }

    /********** CONFIG SYSTEM FOR SCREEN TWO **********/
    const screenTwoComponentIDs = [
      "chitChatOrderSearch","chitChatSearchBtn","chitChatOrders",
      "openConfigBtnScreenTwo","saveConfigBtnScreenTwo","goBackBtn"
    ];

    function populateConfigTableScreenTwo(){
      const tbody = document.getElementById("configTableScreenTwo").querySelector("tbody");
      tbody.innerHTML="";
      screenTwoComponentIDs.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const compName = el.textContent.trim() || el.value?.trim() || id;
        const cs = window.getComputedStyle(el);
        const leftVal = (cs.left==="auto") ? 0 : parseInt(cs.left,10);
        const topVal = (cs.top==="auto") ? 0 : parseInt(cs.top,10);
        const widthVal = (cs.width==="auto") ? 0 : parseInt(cs.width,10);
        const heightVal = (cs.height==="auto") ? 0 : parseInt(cs.height,10);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${compName}</td>
          <td><input type="number" value="${leftVal}" data-id="${id}" class="left-input2"></td>
          <td><input type="number" value="${topVal}" data-id="${id}" class="top-input2"></td>
          <td><input type="number" value="${widthVal}" data-id="${id}" class="width-input2"></td>
          <td><input type="number" value="${heightVal}" data-id="${id}" class="height-input2"></td>
        `;
        tbody.appendChild(row);

        // Live updates
        row.querySelector(".left-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.left = parseInt(this.value,10)+"px";
        });
        row.querySelector(".top-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.top = parseInt(this.value,10)+"px";
        });
        row.querySelector(".width-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.width = parseInt(this.value,10)+"px";
        });
        row.querySelector(".height-input2").addEventListener("input", function(){
          const tgt = document.getElementById(this.getAttribute("data-id"));
          if(tgt) tgt.style.height = parseInt(this.value,10)+"px";
        });
      });
    }

    function saveConfigurationScreenTwo(){
      screenTwoComponentIDs.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          const cs = window.getComputedStyle(el);
          const leftVal = parseInt(cs.left,10)||0;
          const topVal = parseInt(cs.top,10)||0;
          const widthVal = parseInt(cs.width,10)||0;
          const heightVal = parseInt(cs.height,10)||0;
          // prefix them as pos2- to differentiate from screenOne
          localStorage.setItem(`pos2-${id}-left`, leftVal);
          localStorage.setItem(`pos2-${id}-top`, topVal);
          localStorage.setItem(`pos2-${id}-width`, widthVal);
          localStorage.setItem(`pos2-${id}-height`, heightVal);
        }
      });
      console.log("ScreenTwo configuration saved.");
    }
  </script>
</div>